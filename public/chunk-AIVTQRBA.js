import{c as h}from"./chunk-LGC2IQW6.js";import{i as l}from"./chunk-CWSCUUYC.js";import{L as a}from"./chunk-KCBGSXGR.js";import{aa as u,fa as s}from"./chunk-NVPCUW4N.js";import{g as o}from"./chunk-5G567QLT.js";var m=(()=>{class r{constructor(e,t,i){this.authService=e,this.firestoreService=t,this.router=i,this.logged=!1,console.log("UserService init"),this.getState()}getState(){return new Promise((e,t)=>{if(this.logged){e(this.user);return}this.authService.authState.subscribe(i=>{i?(this.user=i,this.logged=!0,this.getUserProfile()):(this.user=null,this.logged=!1),e(this.user)})})}getUserProfile(){return o(this,null,function*(){return new Promise(e=>o(this,null,function*(){if(this.userProfile){e(this.userProfile);return}let t=yield this.firestoreService.getDocument(`usuarios/${this.user.uid}`);if(t.exists()&&(this.userProfile=t.data(),e(this.userProfile),this.userProfile.email!=this.user.email)){console.log("sincronizar email");let i={email:this.user.email};this.firestoreService.updateDocument(`usuarios/${this.user.uid}`,i)}}))})}getLogged(){return this.logged}getRol(){return this.userProfile.rol}getNombreApellido(){return this.userProfile.nombre+" "+this.userProfile.apellido}getId(){return this.userProfile.id}logout(){return this.logged=!1,this.user=null,this.userProfile=null,this.router.navigate(["/home"]),this.authService.logout()}static{this.\u0275fac=function(t){return new(t||r)(s(h),s(a),s(l))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{m as a};
