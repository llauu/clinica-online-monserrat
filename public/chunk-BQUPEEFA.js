import{a as V}from"./chunk-GXSUQVOS.js";import{a as me,b}from"./chunk-5QYNRND2.js";import{a as le}from"./chunk-UIGXXQV5.js";import{c as de}from"./chunk-6QBQ4ZNY.js";import{a as w,b as ne,c as oe}from"./chunk-6L47K6ET.js";import"./chunk-H2WPO2EH.js";import{a as B,b as N,c as Q,d as J,e as G,f as K,g as W,h as X,i as Y,j as Z,k as ee,l as te,m as ie,o as v,p as se}from"./chunk-W5ET73U7.js";import{a as O,d as F,e as U,f as L,g as A,h as ae,j as re}from"./chunk-GBIG63BY.js";import"./chunk-NYWZOZWN.js";import"./chunk-BQSLCKPJ.js";import"./chunk-ZK4NZR2G.js";import{a as ce}from"./chunk-CVIZ75M7.js";import{a as H}from"./chunk-SZYKANWC.js";import{v as j}from"./chunk-PCZAAENJ.js";import"./chunk-KB63F72J.js";import"./chunk-CWSCUUYC.js";import{N as q}from"./chunk-GMVTRFNN.js";import"./chunk-CARY4E7O.js";import{k as $}from"./chunk-V6SC6RTQ.js";import{$a as M,Cb as s,Db as r,Eb as S,Fb as h,Gb as x,Ib as _,Nb as C,Ob as d,Tb as E,Ub as y,Vb as D,Xb as c,Zb as g,_a as l,ec as I,fc as z,ic as P,jc as R,la as k,qb as f,sb as m,va as u,wa as p}from"./chunk-NVPCUW4N.js";import"./chunk-5G567QLT.js";var pe=()=>[10,20,50,100];function fe(i,o){i&1&&(s(0,"th",22)(1,"b",23),c(2,"Paciente"),r()())}function _e(i,o){if(i&1&&(s(0,"td",24),c(1),r()),i&2){let e=o.$implicit;m("appEstadoTurno",e.estado),l(),g(" ",e.paciente," ")}}function Ce(i,o){i&1&&(s(0,"th",25)(1,"b"),c(2,"Especialista"),r()())}function he(i,o){if(i&1&&(s(0,"td",24),c(1),r()),i&2){let e=o.$implicit;m("appEstadoTurno",e.estado),l(),g(" ",e.especialista," ")}}function xe(i,o){i&1&&(s(0,"th",25)(1,"b"),c(2,"Especialidad"),r()())}function ge(i,o){if(i&1&&(s(0,"td",24),c(1),r()),i&2){let e=o.$implicit;m("appEstadoTurno",e.estado),l(),g(" ",e.especialidad," ")}}function be(i,o){i&1&&(s(0,"th",25)(1,"b"),c(2,"Fecha"),r()())}function Te(i,o){if(i&1&&(s(0,"td",24),c(1),P(2,"timestamp"),r()),i&2){let e=o.$implicit;m("appEstadoTurno",e.estado),l(),g(" ",R(2,2,e.fecha)," ")}}function Me(i,o){i&1&&(s(0,"th",25)(1,"b"),c(2,"Horario"),r()())}function Se(i,o){if(i&1&&(s(0,"td",24),c(1),r()),i&2){let e=o.$implicit;m("appEstadoTurno",e.estado),l(),g(" ",e.hora,"hs ")}}function we(i,o){i&1&&(s(0,"th",25)(1,"b"),c(2,"Estado"),r()())}function ve(i,o){if(i&1&&(s(0,"td",24),c(1),P(2,"primerLetraMayus"),r()),i&2){let e=o.$implicit;m("appEstadoTurno",e.estado),l(),g(" ",R(2,2,e.estado)," ")}}function Ee(i,o){i&1&&(s(0,"th",26)(1,"b"),c(2,"Acciones"),r()())}function ye(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=d().$implicit,a=d();return p(a.cancelarTurno(t))}),c(1," Cancelar "),r()}}function De(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=d().$implicit,a=d();return p(a.rechazarTurno(t))}),c(1," Rechazar "),r()}}function Pe(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=d().$implicit,a=d();return p(a.aceptarTurno(t))}),c(1," Aceptar "),r()}}function Re(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=d().$implicit,a=d();return p(a.finalizarTurno(t))}),c(1," Finalizar "),r()}}function Ve(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=d().$implicit,a=d();return p(a.verComentario(t))}),c(1),r()}if(i&2){let e=d().$implicit;l(),g(" ",e.estado==="finalizado"?"Ver rese\xF1a":"Ver comentario"," ")}}function ke(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=d().$implicit,a=d();return p(a.calificarAtencion(t))}),c(1," Calificar atencion "),r()}}function Ie(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=d().$implicit,a=d();return p(a.cargarHistoriaClinica(t))}),c(1," Cargar historia clinica "),r()}}function ze(i,o){if(i&1){let e=_();s(0,"button",30),C("click",function(){u(e);let t=d().$implicit,a=d();return p(a.verHistoriaClinica(t))}),c(1," Ver historia clinica "),r()}}function $e(i,o){if(i&1&&(s(0,"td",24),f(1,ye,2,0,"button",27)(2,De,2,0,"button",27)(3,Pe,2,0,"button",27)(4,Re,2,0,"button",27)(5,Ve,2,1,"button",27)(6,ke,2,0,"button",27)(7,Ie,2,0,"button",27)(8,ze,2,0,"button",28),r()),i&2){let e=o.$implicit,n=d();m("appEstadoTurno",e.estado),l(),m("ngIf",e.estado==="aceptado"),l(),m("ngIf",e.estado==="pendiente"&&n.rolUser==="especialista"),l(),m("ngIf",e.estado==="pendiente"&&n.rolUser==="especialista"),l(),m("ngIf",e.estado==="aceptado"&&n.rolUser==="especialista"),l(),m("ngIf",e.comentario),l(),m("ngIf",e.estado==="finalizado"&&n.rolUser==="paciente"&&!e.comentarioPaciente&&!e.calificacion),l(),m("ngIf",e.estado==="finalizado"&&n.rolUser==="especialista"&&!e.historiaClinica),l(),m("ngIf",e.estado==="finalizado"&&e.historiaClinica)}}function qe(i,o){i&1&&S(0,"tr",31)}function He(i,o){i&1&&S(0,"tr",32)}function Oe(i,o){i&1&&(s(0,"tr",33)(1,"td",34),c(2,"No se encontraron resultados."),r()())}var ct=(()=>{class i{constructor(e,n,t){this.firestoreService=e,this.userService=n,this.dialog=t,this.displayedColumns=["paciente","especialista","especialidad","fecha","hora","estado","acciones"],this.idUser="",this.rolUser="",this.turnoSeleccionado=null,this.idUser=this.userService.getId(),this.rolUser=this.userService.getRol()}ngOnInit(){this.dataSource=new ie,this.rolUser==="especialista"?this.firestoreService.getTurnosPorEspecialista(this.idUser).then(e=>{let n=e.map(t=>({id:t.id,comentario:t.comentario,comentarioPaciente:t.comentarioPaciente,calificacion:t.calificacion,historiaClinica:t.historiaClinica,paciente:t.paciente,especialista:t.especialista,especialidad:t.especialidad,fecha:t.fecha,hora:t.hora,estado:t.estado}));this.dataSource.data=n,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(t,a)=>JSON.stringify(t).toLowerCase().includes(a.trim().toLowerCase())}):this.firestoreService.getTurnosPorPaciente(this.idUser).then(e=>{let n=e.map(t=>({id:t.id,comentario:t.comentario,comentarioPaciente:t.comentarioPaciente,calificacion:t.calificacion,historiaClinica:t.historiaClinica,paciente:t.paciente,especialista:t.especialista,especialidad:t.especialidad,fecha:t.fecha,hora:t.hora,estado:t.estado}));this.dataSource.data=n,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(t,a)=>JSON.stringify(t).toLowerCase().includes(a.trim().toLowerCase())})}verHistoriaClinica(e){this.dialog.open(V,{data:{titulo:"Historia Clinica",mensaje:"Detalles de la historia clinica del paciente.",historiaClinica:e.historiaClinica,editable:!1}}).afterClosed().subscribe(t=>{})}cargarHistoriaClinica(e){this.dialog.open(V,{data:{titulo:"Historia Clinica",mensaje:"Por favor, ingrese los detalles de la historia clinica del paciente.",editable:!0}}).afterClosed().subscribe(t=>{t&&(e.historiaClinica=t,this.firestoreService.updateDocument(`turnos/${e.id}`,{historiaClinica:t}))})}verComentario(e){this.dialog.open(b,{data:{titulo:"Rese\xF1a de la consulta",mensaje:e.comentario,requiereComentario:!1,requiereEncuesta:!1}}).afterClosed().subscribe(t=>{})}calificarAtencion(e){this.dialog.open(b,{data:{titulo:"Calificar atencion",mensaje:"Por favor, deje un comentario de como fue la atencion del especialista.",requiereComentario:!0,requiereEncuesta:!0}}).afterClosed().subscribe(t=>{if(t){let{comentario:a,puntuacion:T}=t;e.comentarioPaciente=a,e.calificacion=T,this.firestoreService.updateDocument(`turnos/${e.id}`,{comentarioPaciente:a,calificacion:T})}})}aceptarTurno(e){this.dialog.open(b,{data:{titulo:"Aceptar turno",mensaje:"\xBFEsta seguro de que desea aceptar este turno?",requiereComentario:!1,requiereEncuesta:!1}}).afterClosed().subscribe(t=>{t&&(e.estado="aceptado",this.firestoreService.updateDocument(`turnos/${e.id}`,{estado:"aceptado"}))})}cancelarTurno(e){this.dialog.open(b,{data:{titulo:"Cancelar turno",mensaje:"Por favor, indique el motivo de la cancelacion del turno.",requiereComentario:!0,requiereEncuesta:!1}}).afterClosed().subscribe(t=>{t&&(e.estado="cancelado",e.comentario=t.comentario,this.firestoreService.updateDocument(`turnos/${e.id}`,{estado:"cancelado",comentario:t.comentario}))})}rechazarTurno(e){this.dialog.open(b,{data:{titulo:"Rechazar turno",mensaje:"Por favor, indique el motivo del rechazo del turno.",requiereComentario:!0,requiereEncuesta:!1}}).afterClosed().subscribe(t=>{t&&(console.log(e),e.estado="rechazado",e.comentario=t.comentario,this.firestoreService.updateDocument(`turnos/${e.id}`,{estado:"rechazado",comentario:t.comentario}))})}finalizarTurno(e){this.dialog.open(b,{data:{titulo:"Finalizar turno",mensaje:"Por favor, ingrese la rese\xF1a y diagnostico de la consulta.",requiereComentario:!0,requiereEncuesta:!1}}).afterClosed().subscribe(t=>{t&&(e.estado="finalizado",e.comentario=t.comentario,this.firestoreService.updateDocument(`turnos/${e.id}`,{estado:"finalizado",comentario:t.comentario}))})}applyFilter(e){let n=e.target.value;this.dataSource.filter=n.trim().toLowerCase()}static{this.\u0275fac=function(n){return new(n||i)(M(q),M(H),M(de))}}static{this.\u0275cmp=k({type:i,selectors:[["app-mis-turnos"]],viewQuery:function(n,t){if(n&1&&(E(v,5),E(w,5)),n&2){let a;y(a=D())&&(t.paginator=a.first),y(a=D())&&(t.sort=a.first)}},standalone:!0,features:[I],decls:34,vars:5,consts:[["input",""],[1,"table-usuarios","mx-5"],[1,"w-100"],[1,"search-field"],["matInput","","placeholder","Buscar...",3,"keyup"],[1,"mat-elevation-z8","shadow-none"],["mat-table","","matSort","","matSortActive","fecha","matSortDirection","desc",3,"dataSource"],["matColumnDef","paciente"],["mat-header-cell","","mat-sort-header","","class","th-p","id","izq",4,"matHeaderCellDef"],["mat-cell","","class","fila-turno",3,"appEstadoTurno",4,"matCellDef"],["matColumnDef","especialista"],["mat-header-cell","","mat-sort-header","","class","th-p",4,"matHeaderCellDef"],["matColumnDef","especialidad"],["matColumnDef","fecha"],["matColumnDef","hora"],["matColumnDef","estado"],["matColumnDef","acciones"],["mat-header-cell","","class","th-p der","id","der",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","fail-search",4,"matNoDataRow"],["aria-label","Selecciona",1,"div-paginator",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header","","id","izq",1,"th-p"],[1,"izq"],["mat-cell","",1,"fila-turno",3,"appEstadoTurno"],["mat-header-cell","","mat-sort-header","",1,"th-p"],["mat-header-cell","","id","der",1,"th-p","der"],["mat-button","","class","btn-accion shadow-sm me-3",3,"click",4,"ngIf"],["mat-button","","class","btn-accion shadow-sm",3,"click",4,"ngIf"],["mat-button","",1,"btn-accion","shadow-sm","me-3",3,"click"],["mat-button","",1,"btn-accion","shadow-sm",3,"click"],["mat-header-row",""],["mat-row",""],[1,"fail-search"],["colspan","7",1,"mat-cell","ps-4","pt-4"]],template:function(n,t){if(n&1){let a=_();s(0,"div",1)(1,"div",2)(2,"mat-form-field",3)(3,"mat-label"),c(4,"Buscar"),r(),s(5,"input",4,0),C("keyup",function(ue){return u(a),p(t.applyFilter(ue))}),r()()(),s(7,"div",5)(8,"table",6),h(9,7),f(10,fe,3,0,"th",8)(11,_e,2,2,"td",9),x(),h(12,10),f(13,Ce,3,0,"th",11)(14,he,2,2,"td",9),x(),h(15,12),f(16,xe,3,0,"th",11)(17,ge,2,2,"td",9),x(),h(18,13),f(19,be,3,0,"th",11)(20,Te,3,4,"td",9),x(),h(21,14),f(22,Me,3,0,"th",11)(23,Se,2,2,"td",9),x(),h(24,15),f(25,we,3,0,"th",11)(26,ve,3,4,"td",9),x(),h(27,16),f(28,Ee,3,0,"th",17)(29,$e,9,9,"td",9),x(),f(30,qe,1,0,"tr",18)(31,He,1,0,"tr",19)(32,Oe,3,0,"tr",20),r(),S(33,"mat-paginator",21),r()()}n&2&&(l(8),m("dataSource",t.dataSource),l(22),m("matHeaderRowDef",t.displayedColumns),l(),m("matRowDefColumns",t.displayedColumns),l(2),m("pageSizeOptions",z(4,pe)))},dependencies:[U,F,O,A,L,te,B,Q,W,J,N,X,G,K,Y,Z,ee,oe,w,ne,se,v,re,ae,$,le,me,j,ce],styles:[".table-usuarios[_ngcontent-%COMP%]{padding-top:150px;padding-bottom:100px}.search-field[_ngcontent-%COMP%]{width:100%;margin:auto}.th-p[_ngcontent-%COMP%]{font-size:17px}th[_ngcontent-%COMP%]{background-color:#d7d7d7!important}#izq[_ngcontent-%COMP%]{border-radius:5px 0 0!important}#der[_ngcontent-%COMP%]{border-radius:0 5px 0 0!important}.fila-turno[_ngcontent-%COMP%]{border:none;color:#171717;background-color:#d7d7d7}.fail-search[_ngcontent-%COMP%]{background-color:#d7d7d7;width:100%!important}.div-paginator[_ngcontent-%COMP%]{background-color:#d7d7d7;border-radius:0 0 5px 5px}.detalle-turno[_ngcontent-%COMP%]{width:100%;min-height:600px;border-radius:5px;background-color:#d7d7d7;display:flex}.btn-accion[_ngcontent-%COMP%]{background-color:#bebebe;min-width:110px;font-weight:600!important}"]})}}return i})();export{ct as MisTurnosComponent};
