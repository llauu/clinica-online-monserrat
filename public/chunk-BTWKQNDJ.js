import{a as P}from"./chunk-2RW6N6Q4.js";import{a as le,d as de,e as b}from"./chunk-TM2JIGAP.js";import{a as ce}from"./chunk-O55KTLHW.js";import{a as w,b as ne,c as oe}from"./chunk-6L47K6ET.js";import"./chunk-H2WPO2EH.js";import{c as N,d as Q,e as B,f as J,g as G,h as K,i as W,j as X,k as Y,l as Z,m as ee,n as te,o as ie,v,w as se}from"./chunk-WVTRBHAQ.js";import{a as O,d as F,e as U,f as A,g as L,h as ae,j as re}from"./chunk-4FB4XD3U.js";import"./chunk-ZK4NZR2G.js";import{a as H}from"./chunk-AIVTQRBA.js";import{v as j}from"./chunk-PCZAAENJ.js";import"./chunk-LGC2IQW6.js";import"./chunk-CWSCUUYC.js";import{L as q}from"./chunk-KCBGSXGR.js";import"./chunk-CARY4E7O.js";import{k as $}from"./chunk-V6SC6RTQ.js";import{$a as M,Cb as s,Db as r,Eb as S,Fb as h,Gb as x,Ib as _,Nb as C,Ob as m,Tb as E,Ub as y,Vb as D,Xb as c,Zb as g,_a as l,ec as V,fc as k,ic as I,jc as z,la as R,qb as f,sb as d,va as u,wa as p}from"./chunk-NVPCUW4N.js";import"./chunk-5G567QLT.js";var ue=()=>[5,10,25,100];function pe(i,o){i&1&&(s(0,"th",22)(1,"b",23),c(2,"Paciente"),r()())}function fe(i,o){if(i&1&&(s(0,"td",24),c(1),r()),i&2){let e=o.$implicit;d("appEstadoTurno",e.estado),l(),g(" ",e.paciente," ")}}function _e(i,o){i&1&&(s(0,"th",25)(1,"b"),c(2,"Especialista"),r()())}function Ce(i,o){if(i&1&&(s(0,"td",24),c(1),r()),i&2){let e=o.$implicit;d("appEstadoTurno",e.estado),l(),g(" ",e.especialista," ")}}function he(i,o){i&1&&(s(0,"th",25)(1,"b"),c(2,"Especialidad"),r()())}function xe(i,o){if(i&1&&(s(0,"td",24),c(1),r()),i&2){let e=o.$implicit;d("appEstadoTurno",e.estado),l(),g(" ",e.especialidad," ")}}function ge(i,o){i&1&&(s(0,"th",25)(1,"b"),c(2,"Fecha"),r()())}function be(i,o){if(i&1&&(s(0,"td",24),c(1),I(2,"timestamp"),r()),i&2){let e=o.$implicit;d("appEstadoTurno",e.estado),l(),g(" ",z(2,2,e.fecha)," ")}}function Te(i,o){i&1&&(s(0,"th",25)(1,"b"),c(2,"Horario"),r()())}function Me(i,o){if(i&1&&(s(0,"td",24),c(1),r()),i&2){let e=o.$implicit;d("appEstadoTurno",e.estado),l(),g(" ",e.hora,"hs ")}}function Se(i,o){i&1&&(s(0,"th",25)(1,"b"),c(2,"Estado"),r()())}function we(i,o){if(i&1&&(s(0,"td",24),c(1),r()),i&2){let e=o.$implicit;d("appEstadoTurno",e.estado),l(),g(" ",e.estado," ")}}function ve(i,o){i&1&&(s(0,"th",26)(1,"b"),c(2,"Acciones"),r()())}function Ee(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=m().$implicit,a=m();return p(a.cancelarTurno(t))}),c(1," Cancelar "),r()}}function ye(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=m().$implicit,a=m();return p(a.rechazarTurno(t))}),c(1," Rechazar "),r()}}function De(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=m().$implicit,a=m();return p(a.aceptarTurno(t))}),c(1," Aceptar "),r()}}function Pe(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=m().$implicit,a=m();return p(a.finalizarTurno(t))}),c(1," Finalizar "),r()}}function Re(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=m().$implicit,a=m();return p(a.verComentario(t))}),c(1),r()}if(i&2){let e=m().$implicit;l(),g(" ",e.estado==="finalizado"?"Ver rese\xF1a":"Ver comentario"," ")}}function Ve(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=m().$implicit,a=m();return p(a.calificarAtencion(t))}),c(1," Calificar atencion "),r()}}function ke(i,o){if(i&1){let e=_();s(0,"button",29),C("click",function(){u(e);let t=m().$implicit,a=m();return p(a.cargarHistoriaClinica(t))}),c(1," Cargar historia clinica "),r()}}function Ie(i,o){if(i&1){let e=_();s(0,"button",30),C("click",function(){u(e);let t=m().$implicit,a=m();return p(a.verHistoriaClinica(t))}),c(1," Ver historia clinica "),r()}}function ze(i,o){if(i&1&&(s(0,"td",24),f(1,Ee,2,0,"button",27)(2,ye,2,0,"button",27)(3,De,2,0,"button",27)(4,Pe,2,0,"button",27)(5,Re,2,1,"button",27)(6,Ve,2,0,"button",27)(7,ke,2,0,"button",27)(8,Ie,2,0,"button",28),r()),i&2){let e=o.$implicit,n=m();d("appEstadoTurno",e.estado),l(),d("ngIf",e.estado==="aceptado"),l(),d("ngIf",e.estado==="pendiente"&&n.rolUser==="especialista"),l(),d("ngIf",e.estado==="pendiente"&&n.rolUser==="especialista"),l(),d("ngIf",e.estado==="aceptado"&&n.rolUser==="especialista"),l(),d("ngIf",e.comentario),l(),d("ngIf",e.estado==="finalizado"&&n.rolUser==="paciente"&&!e.comentarioPaciente&&!e.calificacion),l(),d("ngIf",e.estado==="finalizado"&&n.rolUser==="especialista"&&!e.historiaClinica),l(),d("ngIf",e.estado==="finalizado"&&e.historiaClinica)}}function $e(i,o){i&1&&S(0,"tr",31)}function qe(i,o){i&1&&S(0,"tr",32)}function He(i,o){i&1&&(s(0,"tr",33)(1,"td",34),c(2,"No se encontraron resultados."),r()())}var rt=(()=>{class i{constructor(e,n,t){this.firestoreService=e,this.userService=n,this.dialog=t,this.displayedColumns=["paciente","especialista","especialidad","fecha","hora","estado","acciones"],this.idUser="",this.rolUser="",this.turnoSeleccionado=null,this.idUser=this.userService.getId(),this.rolUser=this.userService.getRol()}ngOnInit(){this.dataSource=new ie,this.rolUser==="especialista"?this.firestoreService.getTurnosPorEspecialista(this.idUser).then(e=>{let n=e.map(t=>({id:t.id,comentario:t.comentario,comentarioPaciente:t.comentarioPaciente,calificacion:t.calificacion,historiaClinica:t.historiaClinica,paciente:t.paciente,especialista:t.especialista,especialidad:t.especialidad,fecha:t.fecha,hora:t.hora,estado:t.estado}));this.dataSource.data=n,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(t,a)=>JSON.stringify(t).toLowerCase().includes(a.trim().toLowerCase())}):this.firestoreService.getTurnosPorPaciente(this.idUser).then(e=>{let n=e.map(t=>({id:t.id,comentario:t.comentario,comentarioPaciente:t.comentarioPaciente,calificacion:t.calificacion,historiaClinica:t.historiaClinica,paciente:t.paciente,especialista:t.especialista,especialidad:t.especialidad,fecha:t.fecha,hora:t.hora,estado:t.estado}));this.dataSource.data=n,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(t,a)=>JSON.stringify(t).toLowerCase().includes(a.trim().toLowerCase())})}verHistoriaClinica(e){this.dialog.open(P,{data:{titulo:"Historia Clinica",mensaje:"Detalles de la historia clinica del paciente.",historiaClinica:e.historiaClinica,editable:!1}}).afterClosed().subscribe(t=>{})}cargarHistoriaClinica(e){this.dialog.open(P,{data:{titulo:"Historia Clinica",mensaje:"Por favor, ingrese los detalles de la historia clinica del paciente.",editable:!0}}).afterClosed().subscribe(t=>{t&&(e.historiaClinica=t,this.firestoreService.updateDocument(`turnos/${e.id}`,{historiaClinica:t}))})}verComentario(e){this.dialog.open(b,{data:{titulo:"Rese\xF1a de la consulta",mensaje:e.comentario,requiereComentario:!1,requiereEncuesta:!1}}).afterClosed().subscribe(t=>{})}calificarAtencion(e){this.dialog.open(b,{data:{titulo:"Calificar atencion",mensaje:"Por favor, deje un comentario de como fue la atencion del especialista.",requiereComentario:!0,requiereEncuesta:!0}}).afterClosed().subscribe(t=>{if(t){let{comentario:a,puntuacion:T}=t;e.comentarioPaciente=a,e.calificacion=T,this.firestoreService.updateDocument(`turnos/${e.id}`,{comentarioPaciente:a,calificacion:T})}})}aceptarTurno(e){this.dialog.open(b,{data:{titulo:"Aceptar turno",mensaje:"\xBFEsta seguro de que desea aceptar este turno?",requiereComentario:!1,requiereEncuesta:!1}}).afterClosed().subscribe(t=>{t&&(e.estado="aceptado",this.firestoreService.updateDocument(`turnos/${e.id}`,{estado:"aceptado"}))})}cancelarTurno(e){this.dialog.open(b,{data:{titulo:"Cancelar turno",mensaje:"Por favor, indique el motivo de la cancelacion del turno.",requiereComentario:!0,requiereEncuesta:!1}}).afterClosed().subscribe(t=>{t&&(e.estado="cancelado",e.comentario=t.comentario,this.firestoreService.updateDocument(`turnos/${e.id}`,{estado:"cancelado",comentario:t.comentario}))})}rechazarTurno(e){this.dialog.open(b,{data:{titulo:"Rechazar turno",mensaje:"Por favor, indique el motivo del rechazo del turno.",requiereComentario:!0,requiereEncuesta:!1}}).afterClosed().subscribe(t=>{t&&(console.log(e),e.estado="rechazado",e.comentario=t.comentario,this.firestoreService.updateDocument(`turnos/${e.id}`,{estado:"rechazado",comentario:t.comentario}))})}finalizarTurno(e){this.dialog.open(b,{data:{titulo:"Finalizar turno",mensaje:"Por favor, ingrese la rese\xF1a y diagnostico de la consulta.",requiereComentario:!0,requiereEncuesta:!1}}).afterClosed().subscribe(t=>{t&&(e.estado="finalizado",e.comentario=t.comentario,this.firestoreService.updateDocument(`turnos/${e.id}`,{estado:"finalizado",comentario:t.comentario}))})}applyFilter(e){let n=e.target.value;this.dataSource.filter=n.trim().toLowerCase()}static{this.\u0275fac=function(n){return new(n||i)(M(q),M(H),M(de))}}static{this.\u0275cmp=R({type:i,selectors:[["app-mis-turnos"]],viewQuery:function(n,t){if(n&1&&(E(v,5),E(w,5)),n&2){let a;y(a=D())&&(t.paginator=a.first),y(a=D())&&(t.sort=a.first)}},standalone:!0,features:[V],decls:34,vars:5,consts:[["input",""],[1,"table-usuarios","mx-5"],[1,"w-100"],[1,"search-field"],["matInput","","placeholder","Buscar...",3,"keyup"],[1,"mat-elevation-z8","shadow-none"],["mat-table","","matSort","","matSortActive","fecha","matSortDirection","desc",3,"dataSource"],["matColumnDef","paciente"],["mat-header-cell","","mat-sort-header","","class","th-p","id","izq",4,"matHeaderCellDef"],["mat-cell","","class","fila-turno",3,"appEstadoTurno",4,"matCellDef"],["matColumnDef","especialista"],["mat-header-cell","","mat-sort-header","","class","th-p",4,"matHeaderCellDef"],["matColumnDef","especialidad"],["matColumnDef","fecha"],["matColumnDef","hora"],["matColumnDef","estado"],["matColumnDef","acciones"],["mat-header-cell","","class","th-p der","id","der",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","fail-search",4,"matNoDataRow"],["aria-label","Selecciona",1,"div-paginator",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header","","id","izq",1,"th-p"],[1,"izq"],["mat-cell","",1,"fila-turno",3,"appEstadoTurno"],["mat-header-cell","","mat-sort-header","",1,"th-p"],["mat-header-cell","","id","der",1,"th-p","der"],["mat-button","","class","btn-accion shadow-sm me-3",3,"click",4,"ngIf"],["mat-button","","class","btn-accion shadow-sm",3,"click",4,"ngIf"],["mat-button","",1,"btn-accion","shadow-sm","me-3",3,"click"],["mat-button","",1,"btn-accion","shadow-sm",3,"click"],["mat-header-row",""],["mat-row",""],[1,"fail-search"],["colspan","7",1,"mat-cell","ps-4","pt-4"]],template:function(n,t){if(n&1){let a=_();s(0,"div",1)(1,"div",2)(2,"mat-form-field",3)(3,"mat-label"),c(4,"Buscar"),r(),s(5,"input",4,0),C("keyup",function(me){return u(a),p(t.applyFilter(me))}),r()()(),s(7,"div",5)(8,"table",6),h(9,7),f(10,pe,3,0,"th",8)(11,fe,2,2,"td",9),x(),h(12,10),f(13,_e,3,0,"th",11)(14,Ce,2,2,"td",9),x(),h(15,12),f(16,he,3,0,"th",11)(17,xe,2,2,"td",9),x(),h(18,13),f(19,ge,3,0,"th",11)(20,be,3,4,"td",9),x(),h(21,14),f(22,Te,3,0,"th",11)(23,Me,2,2,"td",9),x(),h(24,15),f(25,Se,3,0,"th",11)(26,we,2,2,"td",9),x(),h(27,16),f(28,ve,3,0,"th",17)(29,ze,9,9,"td",9),x(),f(30,$e,1,0,"tr",18)(31,qe,1,0,"tr",19)(32,He,3,0,"tr",20),r(),S(33,"mat-paginator",21),r()()}n&2&&(l(8),d("dataSource",t.dataSource),l(22),d("matHeaderRowDef",t.displayedColumns),l(),d("matRowDefColumns",t.displayedColumns),l(2),d("pageSizeOptions",k(4,ue)))},dependencies:[U,F,O,L,A,te,N,B,W,J,Q,X,G,K,Y,Z,ee,oe,w,ne,se,v,re,ae,$,ce,le,j],styles:[".table-usuarios[_ngcontent-%COMP%]{padding-top:150px;padding-bottom:100px}.search-field[_ngcontent-%COMP%]{width:100%;margin:auto}.th-p[_ngcontent-%COMP%]{font-size:17px}th[_ngcontent-%COMP%]{background-color:#d7d7d7!important}#izq[_ngcontent-%COMP%]{border-radius:5px 0 0!important}#der[_ngcontent-%COMP%]{border-radius:0 5px 0 0!important}.fila-turno[_ngcontent-%COMP%]{border:none;color:#171717;background-color:#d7d7d7}.fail-search[_ngcontent-%COMP%]{background-color:#d7d7d7;width:100%!important}.div-paginator[_ngcontent-%COMP%]{background-color:#d7d7d7;border-radius:0 0 5px 5px}.detalle-turno[_ngcontent-%COMP%]{width:100%;min-height:600px;border-radius:5px;background-color:#d7d7d7;display:flex}.btn-accion[_ngcontent-%COMP%]{background-color:#bebebe;min-width:110px;font-weight:600!important}"]})}}return i})();export{rt as MisTurnosComponent};
